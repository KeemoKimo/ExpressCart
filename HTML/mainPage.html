<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/ExpressCart/CSS/general.css">
    <link rel="stylesheet" href="/ExpressCart/CSS/mainPage.css">
    <link rel="stylesheet" href="/ExpressCart/CSS/itemTileStyle.css">
    <title>Main</title>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log('Retrieving data');
            const urlParams = new URLSearchParams(window.location.search);
            var userName = urlParams.get('userName');
            fetch(`api/getItemData?userName=${encodeURIComponent(userName)}`)
                .then(response => response.json())
                .then(data => {
                    const yourItemsContainer = document.getElementById('yourItemsContainer');
                    yourItemsContainer.innerHTML = "";

                    data.slice(0, 5).forEach(data => {
                        const itemTile = `
                    <div class="itemTile">
                        <img src="${data.image_url || 'https://res.cloudinary.com/dkgfcemw4/image/upload/v1739280006/no-photo-or-blank-image-icon.jpg'}" alt="Item Image">
                        <div class="itemTile_lowerDesc">
                            <p class="lblItemTitle">${data.name}</p>
                            <p class="lblLocation">${data.location}</p>
                            <p class="lblDatePosted">${new Date(data.dateposted).toLocaleDateString('en-GB')}</p>
                            <div class="itemTile_bottom">
                                <p class="lblItemPrice">$${Number(data.price).toLocaleString()}</p>
                                <p class="lblItemCondition">${data.condition.toUpperCase()}</p>
                            </div>
                        </div>
                    </div>
                `;
                        yourItemsContainer.innerHTML += itemTile;
                    });
                })
                .catch(error => console.error('Error:', error));
            fetch(`api/getItemData`)
                .then(response => response.json())
                .then(data => {
                    const allItemContainer = document.getElementById('allItemContainer');
                    allItemContainer.innerHTML = "";

                    let largeItemHolder;
                    data.slice(0, 25).forEach((data, index) => {

                        if (index % 5 == 0) {
                            largeItemHolder = document.createElement('div');
                            largeItemHolder.classList.add('fullWidthContainer');
                            allItemContainer.appendChild(largeItemHolder);
                        }

                        const itemTile = `
                    <div class="itemTile">
                        <img src="${data.image_url || 'https://res.cloudinary.com/dkgfcemw4/image/upload/v1739280006/no-photo-or-blank-image-icon.jpg'}" alt="Item Image">
                        <div class="itemTile_lowerDesc">
                            <p class="lblItemTitle">${data.name}</p>
                            <p class="lblLocation">${data.location}</p>
                            <p class="lblDatePosted">${new Date(data.dateposted).toLocaleDateString('en-GB')}</p>
                            <div class="itemTile_bottom">
                                <p class="lblItemPrice">$${Number(data.price).toLocaleString()}</p>
                                <p class="lblItemCondition">${data.condition.toUpperCase()}</p>
                            </div>
                        </div>
                    </div>
                `;

                        largeItemHolder.innerHTML += itemTile;
                    });
                });
        }); 
    </script>
</head>

<body>
    <div id="navBar">
        <h1 id="lblLogo">expressCart.</h1>
        <div id="searchContainer">
            <select name="categories" id="cmbCategories">
                <option value="carsAndVehicle">Cars & Vehicles</option>
                <option value="phonesAndTablet">Phones & Tablets</option>
                <option value="computersAndAccessories">Computers & Accessories</option>
                <option value="electronicsAndAppliances">Electronics & Appliances</option>
                <option value="realEstate">Real Estate</option>
                <option value="fashionAndBeauty">Fashion & Beauty</option>
                <option value="furnitureAndDecor">Furniture & Decor</option>
                <option value="books">Books</option>
                <option value="sportsAndHobbies">Sports & Hobbies</option>
                <option value="healthAndWellness">Health & Wellness</option>
                <option value="allCategories" selected>All Categories</option>
            </select>
            <input type="text" placeholder="What are you looking for today ...." id="txtItems">
        </div>
        <button id="btnSell" onclick="openSellItemPage()">Sell</button>
        <img src="https://cdn-icons-png.flaticon.com/512/4263/4263296.png" alt="" id="imgProfile" onclick="openUserProfilePage()">
    </div>
    <div id="categoriesDiv">
        <div id="topCategoryDiv">
            <div class="categoryBlock" id="categoryCars">
                <img src="https://cdn-icons-png.flaticon.com/512/2555/2555021.png" alt="" class="imgCategory">
                <p>Cars & Vehicles</p>
            </div>
            <div class="categoryBlock" id="categoryPhones">
                <img src="https://cdn-icons-png.flaticon.com/512/1661/1661391.png" alt="" class="imgCategory">
                <p>Phones & Tablets</p>
            </div>
            <div class="categoryBlock" id="categoryComputers">
                <img src="https://cdn-icons-png.flaticon.com/512/3655/3655772.png" alt="" class="imgCategory">
                <p>Computers & Accessories</p>
            </div>
            <div class="categoryBlock" id="categoryElectronics">
                <img src="https://cdn-icons-png.flaticon.com/512/997/997497.png" alt="" class="imgCategory">
                <p>Electronics & Appliances</p>
            </div>
            <div class="categoryBlock" id="categoryRealEstate">
                <img src="https://cdn-icons-png.flaticon.com/512/7403/7403321.png" alt="" class="imgCategory">
                <p>Real Estate</p>
            </div>
        </div>
        <div id="bottomCategoryDiv">
            <div class="categoryBlock" id="categoryFashion">
                <img src="https://cdn-icons-png.flaticon.com/512/3082/3082008.png" alt="" class="imgCategory">
                <p>Fashion & Beauty</p>
            </div>
            <div class="categoryBlock" id="categoryFurniture">
                <img src="https://cdn-icons-png.flaticon.com/512/5540/5540319.png" alt="" class="imgCategory">
                <p>Furniture & Decor</p>
            </div>
            <div class="categoryBlock" id="categoryBooks">
                <img src="https://cdn-icons-png.flaticon.com/512/3232/3232369.png" alt="" class="imgCategory">
                <p>Books</p>
            </div>
            <div class="categoryBlock" id="categorySports">
                <img src="https://cdn-icons-png.flaticon.com/512/857/857455.png" alt="" class="imgCategory">
                <p>Sports & Hobbies</p>
            </div>
            <div class="categoryBlock" id="categoryHealth">
                <img src="https://cdn-icons-png.flaticon.com/512/2869/2869749.png" alt="" class="imgCategory">
                <p>Health & Wellness</p>
            </div>
        </div>
    </div>
    <h1 id="lblYourItems">Your Items</h1>
    <div class="itemContainer" id="yourItemsContainer">
    </div>

    <div id="divider">
    </div>
    <h1 id="lblAllListedItems">All Listed Items Items</h1>

    <div id="allItemContainer">
    </div>
    <form action="/api/uploadImage" method="post" enctype="multipart/form-data" style="display: none;">
        <input type="file" name="image" accept="image/*">
        <button type="submit">Upload</button>
    </form>
    <div id="bottomButtonWrapper">
        <button id="btnViewAll">View All Items</button>
    </div>
</body>
<footer>
    <h2><b>Express Cart</b> developed and maintained by Bunthong Kong Â©</h2>
</footer>
<script>
    const queryString = window.location.search
    const urlParams = new URLSearchParams(queryString)
    const userName = urlParams.get('userName')
    function openSellItemPage() {
        window.location.href = "addItemPage.html?userName=" + userName;
    }

    function openUserProfilePage(){
        window.location.href = "userProfilePage.html?userName=" + userName;
    }
</script>

</html>